import { Fragment, useCallback } from "react";
import { Link, Route, Router, useLocation, useRoute } from "wouter";
import { Blank } from "~/components/Blank";
import { Help } from "~/components/Help";
import { History } from "~/components/History";
import { Panel } from "~/components/Panel";
import { Report } from "~/components/Report";
import { ThemeCycler } from "~/components/ThemeCycler";
import { copy } from "~/lib/clipboard";

export function App() {
  const [hasReportId] = useRoute("/:reportId");
  const [, navigate] = useLocation();

  const onShare = useCallback(() => {
    copy(location.href);
  }, []);

  const onNewReport = useCallback(() => {
    navigate("/");
  }, [navigate]);

  const helpId = "help";
  const historyId = "history";

  return (
    <Fragment>
      <Panel id={helpId} title="Help" side="left">
        <Help />
      </Panel>

      <Panel id={historyId} title="History" side="right">
        <History />
      </Panel>

      <div className="grid grid-rows-[auto_1fr_auto] mx-auto min-h-dvh">
        <header className="grid grid-cols-[1fr_auto_1fr] items-center gap-12 h-18 px-6">
          <h1>
            <Link href="/">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 211 48"
                fill="currentColor"
                className="inline h-9"
                aria-label="localthreat"
              >
                <path d="M40.8492 8H2.15085C0.965341 8 0 8.89749 0 9.99968V37.9873C0 39.0895 0.965341 39.987 2.15085 39.987H7.73966C8.21386 39.987 8.60339 40.3413 8.60339 40.79V47.1985C8.60339 47.907 9.52639 48.2692 10.0683 47.7653L17.1983 40.2626C17.3592 40.0894 17.5963 39.9949 17.8419 39.9949H40.8492C42.0347 39.9949 43 39.0974 43 37.9952V9.99968C43 8.89749 42.0347 8 40.8492 8ZM23.6508 35.1846C23.6508 35.6255 23.2698 35.9877 22.7871 35.9877H20.2044C19.7302 35.9877 19.3407 35.6334 19.3407 35.1846V32.7834C19.3407 32.3426 19.7217 31.9804 20.2044 31.9804H22.7871C23.2613 31.9804 23.6508 32.3347 23.6508 32.7834V35.1846ZM23.6508 27.1938C23.6508 27.6347 23.2698 27.9968 22.7871 27.9968H20.2044C19.7302 27.9968 19.3407 27.6425 19.3407 27.1938V12.7945C19.3407 12.3536 19.7217 11.9915 20.2044 11.9915H22.7871C23.2613 11.9915 23.6508 12.3458 23.6508 12.7945V27.1938Z" />
                <path d="M59.5794 35.1162C59.2249 35.1162 58.9196 34.9981 58.6635 34.7619C58.4272 34.506 58.309 34.2009 58.309 33.8466V15.9249H55.6204C55.4432 15.9249 55.2954 15.8659 55.1773 15.7478C55.0591 15.6297 55 15.482 55 15.3049V13.12C55 12.9429 55.0591 12.7953 55.1773 12.6771C55.2954 12.559 55.4432 12.5 55.6204 12.5H60.5839C60.9384 12.5 61.2339 12.6279 61.4702 12.8838C61.7263 13.12 61.8543 13.4153 61.8543 13.7696V31.6913H64.5429C64.7201 31.6913 64.8678 31.7503 64.986 31.8684C65.1042 31.9865 65.1633 32.1341 65.1633 32.3113V34.4961C65.1633 34.6733 65.1042 34.8209 64.986 34.939C64.8678 35.0571 64.7201 35.1162 64.5429 35.1162H59.5794Z" />
                <path d="M73.6391 35.5C72.3588 35.5 71.177 35.1949 70.0938 34.5847C69.0302 33.9549 68.1832 33.1085 67.5529 32.0456C66.9226 30.9827 66.6075 29.8312 66.6075 28.5911V24.7234C66.6075 23.4833 66.9226 22.3318 67.5529 21.2689C68.1832 20.206 69.0302 19.3695 70.0938 18.7593C71.177 18.1294 72.3588 17.8145 73.6391 17.8145C74.9193 17.8145 76.0913 18.1294 77.1549 18.7593C78.2382 19.3695 79.095 20.206 79.7252 21.2689C80.3555 22.3318 80.6707 23.4833 80.6707 24.7234V28.5911C80.6707 29.8312 80.3555 30.9827 79.7252 32.0456C79.095 33.1085 78.2382 33.9549 77.1549 34.5847C76.0913 35.1949 74.9193 35.5 73.6391 35.5ZM73.6391 32.0751C74.6042 32.0751 75.4216 31.7405 76.0913 31.0712C76.7806 30.3823 77.1253 29.5556 77.1253 28.5911V24.7234C77.1253 23.7589 76.7806 22.942 76.0913 22.2728C75.4216 21.5839 74.6042 21.2394 73.6391 21.2394C72.674 21.2394 71.8467 21.5839 71.1574 22.2728C70.4877 22.942 70.1528 23.7589 70.1528 24.7234V28.5911C70.1528 29.5556 70.4877 30.3823 71.1574 31.0712C71.8467 31.7405 72.674 32.0751 73.6391 32.0751Z" />
                <path d="M90.3813 35.5C89.1011 35.5 87.9193 35.1851 86.836 34.5552C85.7724 33.9253 84.9254 33.0691 84.2952 31.9865C83.6649 30.9039 83.3497 29.7229 83.3497 28.4435V24.871C83.3497 23.5916 83.6649 22.4106 84.2952 21.328C84.9254 20.2454 85.7724 19.3892 86.836 18.7593C87.9193 18.1294 89.1011 17.8145 90.3813 17.8145C91.3661 17.8145 92.3116 18.0212 93.2176 18.4345C94.1236 18.8282 94.9016 19.3892 95.5516 20.1175C95.6895 20.2552 95.7584 20.4127 95.7584 20.5899C95.7584 20.8064 95.6698 21.0032 95.4925 21.1804L94.2221 22.4499C94.0842 22.5877 93.9267 22.6566 93.7494 22.6566C93.5721 22.6566 93.4047 22.568 93.2471 22.3909C92.479 21.6232 91.5237 21.2394 90.3813 21.2394C89.4162 21.2394 88.589 21.5839 87.8996 22.2728C87.2299 22.942 86.8951 23.7589 86.8951 24.7234V28.5911C86.8951 29.5556 87.2299 30.3823 87.8996 31.0712C88.589 31.7405 89.4162 32.0751 90.3813 32.0751C91.5237 32.0751 92.479 31.6913 93.2471 30.9236C93.4047 30.7465 93.5721 30.6579 93.7494 30.6579C93.9267 30.6579 94.0842 30.7268 94.2221 30.8646L95.4925 32.1341C95.6698 32.3113 95.7584 32.5081 95.7584 32.7246C95.7584 32.9018 95.6895 33.0593 95.5516 33.197C94.9016 33.9253 94.1236 34.4961 93.2176 34.9095C92.3116 35.3032 91.3661 35.5 90.3813 35.5Z" />
                <path d="M102.981 35.5C101.326 35.5 99.9772 35.0374 98.9333 34.1123C97.9091 33.1675 97.397 31.9472 97.397 30.4512C97.397 29.0931 97.8697 27.9711 98.8151 27.0854C99.7605 26.1799 101.09 25.5894 102.804 25.3139C103.237 25.2745 103.651 25.2154 104.044 25.1367C105.423 24.9792 106.26 24.8611 106.556 24.7824C107.285 24.6643 107.649 24.251 107.649 23.5424C107.649 22.8141 107.344 22.2334 106.733 21.8004C106.142 21.3477 105.394 21.1213 104.488 21.1213C102.892 21.1213 101.73 21.702 101.001 22.8633C100.844 23.1192 100.657 23.2471 100.44 23.2471C100.282 23.2471 100.154 23.2077 100.056 23.129L98.4015 22.0071C98.2242 21.889 98.1356 21.7217 98.1356 21.5051C98.1356 21.4461 98.1553 21.3575 98.1947 21.2394C98.7659 20.1568 99.6128 19.3203 100.736 18.7298C101.858 18.1196 103.129 17.8145 104.547 17.8145C105.847 17.8145 106.989 18.0605 107.974 18.5526C108.959 19.0447 109.717 19.7435 110.249 20.6489C110.8 21.5543 111.076 22.5976 111.076 23.7786V34.4961C111.076 34.6733 111.017 34.8209 110.899 34.939C110.781 35.0571 110.633 35.1162 110.456 35.1162H108.447C108.269 35.1162 108.122 35.067 108.003 34.9685C107.885 34.8505 107.826 34.693 107.826 34.4961V33.3447C106.467 34.7816 104.852 35.5 102.981 35.5ZM103.247 32.3408C104.015 32.3408 104.744 32.144 105.433 31.7503C106.122 31.3567 106.674 30.8449 107.088 30.215C107.521 29.5655 107.738 28.8864 107.738 28.1778V27.5873L105.522 27.9121C104.32 28.0499 103.542 28.1581 103.188 28.2368C101.573 28.5321 100.765 29.2309 100.765 30.3331C100.765 30.9433 100.992 31.4354 101.445 31.8094C101.898 32.1637 102.498 32.3408 103.247 32.3408Z" />
                <path d="M116.883 35.1162C116.528 35.1162 116.223 34.9981 115.967 34.7619C115.731 34.506 115.613 34.2009 115.613 33.8466V15.9249H112.924C112.747 15.9249 112.599 15.8659 112.481 15.7478C112.363 15.6297 112.304 15.482 112.304 15.3049V13.12C112.304 12.9429 112.363 12.7953 112.481 12.6771C112.599 12.559 112.747 12.5 112.924 12.5H117.887C118.242 12.5 118.537 12.6279 118.774 12.8838C119.03 13.12 119.158 13.4153 119.158 13.7696V31.6913H121.846C122.024 31.6913 122.171 31.7503 122.29 31.8684C122.408 31.9865 122.467 32.1341 122.467 32.3113V34.4961C122.467 34.6733 122.408 34.8209 122.29 34.939C122.171 35.0571 122.024 35.1162 121.846 35.1162H116.883Z" />
                <path d="M130.802 35.1162C129.266 35.1162 128.015 34.6438 127.05 33.699C126.104 32.7542 125.632 31.5141 125.632 29.9788V21.5051H123.593C123.416 21.5051 123.268 21.4461 123.15 21.328C123.032 21.2099 122.973 21.0623 122.973 20.8851V18.8184C122.973 18.6412 123.032 18.4936 123.15 18.3755C123.268 18.2574 123.416 18.1983 123.593 18.1983H125.632V15.0096C125.632 14.8325 125.691 14.6849 125.809 14.5668C125.927 14.4487 126.075 14.3896 126.252 14.3896H128.556C128.734 14.3896 128.881 14.4487 129 14.5668C129.118 14.6849 129.177 14.8325 129.177 15.0096V18.1983H134.17C134.347 18.1983 134.495 18.2574 134.613 18.3755C134.731 18.4936 134.79 18.6412 134.79 18.8184V20.9146C134.79 21.0918 134.731 21.2394 134.613 21.3575C134.495 21.4756 134.347 21.5347 134.17 21.5347H129.177V29.8312C129.177 30.4217 129.344 30.8941 129.679 31.2484C130.034 31.6027 130.497 31.7798 131.068 31.7798L134.17 31.8094C134.347 31.8094 134.495 31.8684 134.613 31.9865C134.731 32.1046 134.79 32.2522 134.79 32.4294V34.4961C134.79 34.6733 134.731 34.8209 134.613 34.939C134.495 35.0571 134.347 35.1162 134.17 35.1162H130.802Z" />
                <path d="M138.316 35.1162C138.139 35.1162 137.992 35.0571 137.873 34.939C137.755 34.8209 137.696 34.6733 137.696 34.4961V13.12C137.696 12.9429 137.755 12.7953 137.873 12.6771C137.992 12.559 138.139 12.5 138.316 12.5H140.621C140.798 12.5 140.946 12.559 141.064 12.6771C141.182 12.7953 141.241 12.9429 141.241 13.12V19.6451C141.813 19.0742 142.463 18.6314 143.191 18.3164C143.92 17.9818 144.669 17.8145 145.437 17.8145C146.658 17.8145 147.731 18.0802 148.657 18.6117C149.602 19.1234 150.331 19.8517 150.843 20.7965C151.355 21.7217 151.612 22.7944 151.612 24.0148V34.4961C151.612 34.6733 151.552 34.8209 151.434 34.939C151.316 35.0571 151.168 35.1162 150.991 35.1162H148.687C148.509 35.1162 148.362 35.0571 148.243 34.939C148.125 34.8209 148.066 34.6733 148.066 34.4961V24.4576C148.066 23.4144 147.8 22.6172 147.268 22.0661C146.737 21.4953 145.988 21.2099 145.023 21.2099C143.861 21.2099 142.935 21.5937 142.246 22.3614C141.576 23.1093 141.241 24.1427 141.241 25.4615V34.4961C141.241 34.6733 141.182 34.8209 141.064 34.939C140.946 35.0571 140.798 35.1162 140.621 35.1162H138.316Z" />
                <path d="M154.956 35.1162C154.778 35.1162 154.631 35.0571 154.512 34.939C154.394 34.8209 154.335 34.6733 154.335 34.4961V32.3113C154.335 32.1341 154.394 31.9865 154.512 31.8684C154.631 31.7503 154.778 31.6913 154.956 31.6913H157.201V21.5347H154.66C154.483 21.5347 154.335 21.4756 154.217 21.3575C154.099 21.2394 154.04 21.0918 154.04 20.9146V18.8184C154.04 18.6412 154.099 18.4936 154.217 18.3755C154.335 18.2574 154.483 18.1983 154.66 18.1983H159.24C159.594 18.1983 159.889 18.3263 160.126 18.5822C160.382 18.8184 160.51 19.1136 160.51 19.4679V20.5308L162.105 19.2612C162.696 18.7888 163.208 18.4641 163.642 18.2869C164.075 18.0901 164.587 17.9917 165.178 17.9917H166.094C166.271 17.9917 166.419 18.0507 166.537 18.1688C166.655 18.2869 166.714 18.4345 166.714 18.6117V20.8851C166.714 21.0623 166.655 21.2099 166.537 21.328C166.419 21.4461 166.271 21.5051 166.094 21.5051H165.326C164.814 21.5051 164.37 21.5937 163.996 21.7709C163.622 21.948 163.051 22.3417 162.283 22.9519L160.658 24.251V31.6913H163.583C163.76 31.6913 163.908 31.7503 164.026 31.8684C164.144 31.9865 164.203 32.1341 164.203 32.3113V34.4961C164.203 34.6733 164.144 34.8209 164.026 34.939C163.908 35.0571 163.76 35.1162 163.583 35.1162H154.956Z" />
                <path d="M175.053 35.1162C173.772 35.1162 172.591 34.8012 171.507 34.1714C170.444 33.5415 169.597 32.6853 168.967 31.6027C168.336 30.5201 168.021 29.3391 168.021 28.0597V24.871C168.021 23.5916 168.336 22.4106 168.967 21.328C169.597 20.2454 170.444 19.3892 171.507 18.7593C172.591 18.1294 173.772 17.8145 175.053 17.8145C176.333 17.8145 177.505 18.1294 178.569 18.7593C179.652 19.3892 180.509 20.2454 181.139 21.328C181.769 22.4106 182.084 23.5916 182.084 24.871V26.8492C182.084 27.2035 181.956 27.5086 181.7 27.7644C181.464 28.0006 181.168 28.1187 180.814 28.1187H171.566V28.2664C171.566 29.2309 171.901 30.0576 172.571 30.7465C173.26 31.4157 174.088 31.7503 175.053 31.7503H179.75C179.928 31.7503 180.075 31.8094 180.193 31.9275C180.312 32.0456 180.371 32.1932 180.371 32.3703V34.4961C180.371 34.6733 180.312 34.8209 180.193 34.939C180.075 35.0571 179.928 35.1162 179.75 35.1162H175.053ZM178.539 24.93V24.6643C178.539 23.6998 178.194 22.883 177.505 22.2137C176.835 21.5248 176.018 21.1804 175.053 21.1804C174.088 21.1804 173.26 21.5248 172.571 22.2137C171.901 22.883 171.566 23.6998 171.566 24.6643V24.93H178.539Z" />
                <path d="M189.21 35.5C187.556 35.5 186.207 35.0374 185.163 34.1123C184.138 33.1675 183.626 31.9472 183.626 30.4512C183.626 29.0931 184.099 27.9711 185.044 27.0854C185.99 26.1799 187.319 25.5894 189.033 25.3139C189.466 25.2745 189.88 25.2154 190.274 25.1367C191.653 24.9792 192.49 24.8611 192.785 24.7824C193.514 24.6643 193.878 24.251 193.878 23.5424C193.878 22.8141 193.573 22.2334 192.962 21.8004C192.372 21.3477 191.623 21.1213 190.717 21.1213C189.122 21.1213 187.96 21.702 187.231 22.8633C187.073 23.1192 186.886 23.2471 186.669 23.2471C186.512 23.2471 186.384 23.2077 186.285 23.129L184.631 22.0071C184.454 21.889 184.365 21.7217 184.365 21.5051C184.365 21.4461 184.385 21.3575 184.424 21.2394C184.995 20.1568 185.842 19.3203 186.965 18.7298C188.088 18.1196 189.358 17.8145 190.776 17.8145C192.076 17.8145 193.218 18.0605 194.203 18.5526C195.188 19.0447 195.946 19.7435 196.478 20.6489C197.03 21.5543 197.305 22.5976 197.305 23.7786V34.4961C197.305 34.6733 197.246 34.8209 197.128 34.939C197.01 35.0571 196.862 35.1162 196.685 35.1162H194.676C194.499 35.1162 194.351 35.067 194.233 34.9685C194.115 34.8505 194.056 34.693 194.056 34.4961V33.3447C192.697 34.7816 191.081 35.5 189.21 35.5ZM189.476 32.3408C190.244 32.3408 190.973 32.144 191.662 31.7503C192.352 31.3567 192.903 30.8449 193.317 30.215C193.75 29.5655 193.967 28.8864 193.967 28.1778V27.5873L191.751 27.9121C190.55 28.0499 189.772 28.1581 189.417 28.2368C187.802 28.5321 186.994 29.2309 186.994 30.3331C186.994 30.9433 187.221 31.4354 187.674 31.8094C188.127 32.1637 188.728 32.3408 189.476 32.3408Z" />
                <path d="M207.011 35.1162C205.475 35.1162 204.224 34.6438 203.259 33.699C202.314 32.7542 201.841 31.5141 201.841 29.9788V21.5051H199.803C199.625 21.5051 199.478 21.4461 199.359 21.328C199.241 21.2099 199.182 21.0623 199.182 20.8851V18.8184C199.182 18.6412 199.241 18.4936 199.359 18.3755C199.478 18.2574 199.625 18.1983 199.803 18.1983H201.841V15.0096C201.841 14.8325 201.9 14.6849 202.018 14.5668C202.137 14.4487 202.284 14.3896 202.462 14.3896H204.766C204.943 14.3896 205.091 14.4487 205.209 14.5668C205.327 14.6849 205.387 14.8325 205.387 15.0096V18.1983H210.38C210.557 18.1983 210.705 18.2574 210.823 18.3755C210.941 18.4936 211 18.6412 211 18.8184V20.9146C211 21.0918 210.941 21.2394 210.823 21.3575C210.705 21.4756 210.557 21.5347 210.38 21.5347H205.387V29.8312C205.387 30.4217 205.554 30.8941 205.889 31.2484C206.243 31.6027 206.706 31.7798 207.277 31.7798L210.38 31.8094C210.557 31.8094 210.705 31.8684 210.823 31.9865C210.941 32.1046 211 32.2522 211 32.4294V34.4961C211 34.6733 210.941 34.8209 210.823 34.939C210.705 35.0571 210.557 35.1162 210.38 35.1162H207.011Z" />
              </svg>
            </Link>
          </h1>

          <menu className="flex items-center gap-6 font-bold">
            <li>
              <button onClick={onShare} disabled={!hasReportId}>
                Share
              </button>
            </li>
            <li>
              <button onClick={onNewReport} disabled={!hasReportId}>
                New Report
              </button>
            </li>
            <li>
              <button popoverTarget={historyId}>History</button>
            </li>
          </menu>

          <menu className="flex items-center gap-6 justify-self-end font-bold">
            <li>
              <button popoverTarget={helpId}>Help</button>
            </li>
            <li>
              <ThemeCycler />
            </li>
          </menu>
        </header>

        <Router>
          <Route path="/" component={Blank} />
          <Route path="/:reportId" component={Report} />
        </Router>

        <footer className="flex flex-col gap-3 p-6 items-center text-center not-hover:opacity-50 transition-opacity">
          <p>
            © 2017 Arthur Corenzan. Source and feedback on{" "}
            <a
              className="underline"
              href="http://github.com/haggen/localthreat"
            >
              GitHub
            </a>
            . Data provided by{" "}
            <a className="underline" href="https://esi.evetech.net/latest/">
              ESI
            </a>{" "}
            and{" "}
            <a className="underline" href="https://zkillboard.com/">
              zKillboard
            </a>
            . Tips go to{" "}
            <a
              className="underline"
              href="https://zkillboard.com/character/95036967/"
            >
              Jason Chorant
            </a>
            .
          </p>
          <p className="text-xs max-w-2/3">
            EVE Online and the EVE logo are registered trademarks of CCP hf. All
            rights reserved. All other trademarks are the property of their
            respective owners. localthreat is an independent project and is not
            affiliated with, sponsored, or endorsed by CCP hf.
          </p>
        </footer>
      </div>
    </Fragment>
  );
}
